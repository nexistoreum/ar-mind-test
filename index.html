<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Interactive AR Mars - Stable Version</title>

<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

<style>
body { margin:0; overflow:hidden; font-family:sans-serif; }

#capture-btn{
position:fixed;
bottom:30px;
left:50%;
transform:translateX(-50%);
width:80px;height:80px;
background:white;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:30px;
z-index:999;
}

#sound-btn{
position:fixed;
top:20px;
left:20px;
width:45px;height:45px;
background:rgba(0,0,0,0.6);
border-radius:10px;
display:flex;
align-items:center;
justify-content:center;
color:white;
font-size:22px;
z-index:999;
}
</style>
</head>

<body>

<div id="sound-btn">ðŸ”ˆ</div>
<div id="capture-btn">ðŸ“¸</div>

<a-scene
embedded
screenshot
renderer="preserveDrawingBuffer:true; antialias:true; alpha:true;"
arjs="sourceType:webcam; debugUIEnabled:false;"
vr-mode-ui="enabled:false">

<a-assets>
<a-asset-item id="mars-model" src="mars_glb-opt.glb"></a-asset-item>
<audio id="bg-music" src="VENUS_Master.mp3" loop="true"></audio>
</a-assets>

<a-entity id="mars-wrapper" position="0 1.2 -5">
<a-entity gltf-model="#mars-model" scale="1 1 1" animation-mixer></a-entity>
</a-entity>

<a-light type="ambient" intensity="1.5"></a-light>
<a-light type="directional" position="1 2 1" intensity="0.5"></a-light>

<a-camera look-controls></a-camera>

</a-scene>

<script>

/* ===== SOUND ===== */
const soundBtn = document.querySelector('#sound-btn');
const audio = document.querySelector('#bg-music');
let isMuted = true;

soundBtn.onclick = ()=>{
if(isMuted){
audio.play().catch(()=>{});
soundBtn.innerText="ðŸ”Š";
}else{
audio.pause();
soundBtn.innerText="ðŸ”ˆ";
}
isMuted=!isMuted;
};

/* ===== CAPTURE (à¹€à¸ªà¸–à¸µà¸¢à¸£) ===== */
const captureBtn = document.querySelector('#capture-btn');
captureBtn.onclick = async ()=>{

const scene = document.querySelector('a-scene');
scene.renderer.render(scene.object3D, scene.camera);

const canvas = scene.renderer.domElement;
const dataURL = canvas.toDataURL("image/png");

const blob = await (await fetch(dataURL)).blob();
const file = new File([blob], "mars-ar.png", {type:"image/png"});

if(navigator.canShare && navigator.canShare({files:[file]})){
try{
await navigator.share({
files:[file],
title:"Mars AR",
text:"My AR Capture"
});
}catch(e){}
}else{
const link=document.createElement('a');
link.download="mars-ar.png";
link.href=dataURL;
link.click();
}
};

/* ===== DRAG SYSTEM (à¹à¸à¸™ XZ à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™) ===== */

const mars = document.querySelector('#mars-wrapper');
const scene = document.querySelector('a-scene');
let isDragging=false;

scene.addEventListener('mousedown',()=>isDragging=true);
scene.addEventListener('mouseup',()=>isDragging=false);
scene.addEventListener('touchstart',()=>isDragging=true);
scene.addEventListener('touchend',()=>isDragging=false);

scene.addEventListener('mousemove',(e)=>{
if(!isDragging) return;

const camera = scene.camera;
const raycaster = new THREE.Raycaster();

const mouse = new THREE.Vector2(
(e.clientX/window.innerWidth)*2-1,
-(e.clientY/window.innerHeight)*2+1
);

raycaster.setFromCamera(mouse,camera);

const plane = new THREE.Plane(new THREE.Vector3(0,1,0), -1.2);
const point = new THREE.Vector3();
raycaster.ray.intersectPlane(plane,point);

mars.object3D.position.set(point.x,1.2,point.z);
});

/* ===== ZOOM ===== */

let startY=0;
let startScale=1;
const sensitivity=0.005;

window.addEventListener('touchstart',(e)=>{
if(e.touches.length===1){
startY=e.touches[0].pageY;
startScale=mars.object3D.scale.x;
}
});

window.addEventListener('touchmove',(e)=>{
if(e.touches.length===1){
let diffY=startY-e.touches[0].pageY;
let newScale=startScale-(diffY*sensitivity);
newScale=Math.min(Math.max(newScale,0.1),10);
mars.object3D.scale.set(newScale,newScale,newScale);
}
});

</script>

</body>
</html>
